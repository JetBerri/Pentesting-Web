# ¿Qué es Path Traversal?

<img src="https://raw.githubusercontent.com/0nyxMind/Pentesting-Web/main/Vulnerabilidades/Imagenes-Vulns/path-traversal-banner.png">

Path Traversal es una vulnerabilidad de seguridad web que permite a un atacante leer archivos arbitrarios de un servidor web, como archivos de configuración o contraseñas.

Aquí estarán las resoluciones de los laboratorios de [PortSwigger](https://portswigger.net/web-security/file-path-traversal)

# 1. Lab: File path traversal, simple case

> https://portswigger.net/web-security/file-path-traversal/lab-simple

Al entrar el laboratorio veremos esto:

<img src="https://raw.githubusercontent.com/0nyxMind/Pentesting-Web/main/Vulnerabilidades/Imagenes-Vulns/lab1-lfi.png">

Si abrimos las imágenes en una nueva pestaña, veremos que se cargan mediante el parámetro ```filename?=image.jpg```

Si cambiamos el valor de ```image.jpg``` por ```../../../../../etc/passwd```

<img src="https://raw.githubusercontent.com/0nyxMind/Pentesting-Web/main/Vulnerabilidades/Imagenes-Vulns/bypass1.png">

# 2. Lab: Traversal sequences blocked with absolute path bypass

> https://portswigger.net/web-security/file-path-traversal/lab-absolute-path-bypass

Al ingresar al laboratorio, veremos lo mismo que antes. Por lo tanto, si intentamos acceder al archivo ```/etc/passwd``` mediante un path traversal, no lo podremos ver.
Pero no siempre es necesario poner ```../../../../../```, si no hay ningun tipo de proteccion aplicada, solo basta con poner la ruta absoluta, es decir ```/etc/passwd```

<img src="https://raw.githubusercontent.com/0nyxMind/Pentesting-Web/main/Vulnerabilidades/Imagenes-Vulns/bypass2.png">

# 3. Lab: Traversal sequences stripped non-recursively

> https://0a9c008704527f84c0612cd700a000f5.web-security-academy.net/

Para no estar repitiendo lo mismo, cabe aclarar que todos los laboratorios son iguales, si ahora intentamos leer el archivo ```/etc/passwd```, ya sea haciendo uso de un path traversal o apuntando directamente, no podremos.

Supongamos que una página implementa como mecanismo de seguridad que nosotros al poner un ```../``` lo sustituya a nada, es decir, que nos lo elimine.

Ejemplo: 

```
../ ➜ " "
```

Una forma de bypassear esto es poniendo ```....//```, ya que al aplicar la sustitución nos quedara así
```
....//   ➜   ../
```

<img src="https://raw.githubusercontent.com/0nyxMind/Pentesting-Web/main/Vulnerabilidades/Imagenes-Vulns/bypass3.png">

# 4. Lab: Traversal sequences stripped with superfluous URL-decode

> https://portswigger.net/web-security/file-path-traversal/lab-superfluous-url-decode

Para poder resolver este laboratorio, debemos usar otra forma de bypassear las protecciones colocadas, una forma de apuntar al archivo ```/etc/passwd``` es URL Encodeando la barra, y luego el "%", es decir

```
../ ➜ ..%2f ➜ ..%252f
```

<img src="https://raw.githubusercontent.com/0nyxMind/Pentesting-Web/main/Vulnerabilidades/Imagenes-Vulns/bypass4.png">

# 5. Lab: Validation of start of path

> https://portswigger.net/web-security/file-path-traversal/lab-validate-start-of-path

En este laboratorio, nos muestran la ruta de la cual se cargan las imágenes ```filename=/var/www/images/imagen.jpg```, al igual que antes, simplemente basta con volver unos directorios hacia atrás, hasta llegar a la raíz

<img src="https://raw.githubusercontent.com/0nyxMind/Pentesting-Web/main/Vulnerabilidades/Imagenes-Vulns/bypass5.png">

# 6. Lab: Validation of file extension with null byte bypass

> https://portswigger.net/web-security/file-path-traversal/lab-validate-file-extension-null-byte-bypass

Hay veces que como mecanismo de "proteccion", a nivel de código ponen que el archivo que se incluya tiene que tener una extensión definida, como por ejemplo ```.jpg```

Una función que podemos usar para saltarnos esta protección es usar el carácter ```"%00"```, con este carácter hacemos que todo lo que le siga se cancele

<img src="https://raw.githubusercontent.com/0nyxMind/Pentesting-Web/main/Vulnerabilidades/Imagenes-Vulns/bypass6.png">

# Bypass via wrappers

Estas no son las únicas formas de bypassear protecciones, también podemos hacer uso de los wrappers.

# ¿Qué es un wrapper? 

En el contexto de las URLs, un ```wrapper``` es una forma de especificar el protocolo que se utilizará para recuperar el contenido de una URL
Algunos de los ```wrappers``` más conocidos son:

- ```file://``` ➜ Nos permite acceder a archivos locales.
- ```mailto:``` ➜ Para enviar un correo electrónico.
- ```ftp://``` ➜ Para acceder a recursos a través del protocolo FTP.
- ```data:``` ➜ Para incrustar datos directamente en la URL, como imágenes o archivos de audio.

Existen muchos más.

Para este caso, vamos a practicar con nuestra propia máquina local, lo primero que vamos a hacer es habilitar el servicio de apache

```
❯ service apache2 start
```
